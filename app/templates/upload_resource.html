{% extends "base.html" %}
{% block title %}Sys Course: Upload Resources{% endblock %}
{% block head_extension %}
  <link href="https://unpkg.com/filepond/dist/filepond.css" rel="stylesheet">
  <link href="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.css" rel="stylesheet">
  <link href="https://unpkg.com/filepond-plugin-file-validate-type/dist/filepond-plugin-file-validate-type.css" rel="stylesheet">
  <link rel="stylesheet" href="/static/upload_resource.css">
{% endblock %}
{% block content %}
  <section class="hero is-medium">
    <div class="hero-body">
      <div class="container has-text-centered">
        <h1 class="title">Upload Your Course Resources</h1>
        <h2 class="subtitle">
          You can upload images or PDF documents.
        </h2>
      </div>
    </div>
  </section>
  <div class="container">
    <form id="resource-upload-form" action="/upload_resource" method="POST" enctype="multipart/form-data">
      {{ form.csrf_token }}
      <div class="field">
        <label class="label">Course</label>
        <div class="control has-icons-left">
          <div class="select is-fullwidth">
            <span class="icon is-small is-left">
              <i class="fas fa-book"></i>
            </span>
            <select name="course_id">
              {% for choice in form.course_id.choices %}
                <option value="{{ choice[0] }}">{{ choice[1] }}</option>
              {% endfor %}
            </select>
          </div>
        </div>
      </div>
      <div class="field">
        <label class="label">Title</label>
        <div class="control">
          <input class="input" type="text" name="title" placeholder="Resource title" required>
        </div>
      </div>
      <div class="field">
        <label class="label">Description</label>
        <div class="control">
          <textarea class="textarea" name="description" placeholder="Resource description" required></textarea>
        </div>
      </div>
      <!-- FilePond input for file upload -->
      <input type="file" class="filepond" name="resourceFile" accept="image/png, image/jpeg, application/pdf">
      <!-- Display file name and type after upload -->
      <div id="file-info">
        <p>File Name: <span id="file-name"></span></p>
        <p>File Type: <span id="file-type"></span></p>
      </div>
      <div class="field">
        <div class="control">
          <button class="button is-link" type="submit">Submit</button>
        </div>
      </div>
    </form>
  </div>
  <!-- Include your FilePond and other JS at the bottom of the page -->
  <script src="https://unpkg.com/filepond/dist/filepond.js"></script>
  <script src="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.js"></script>
  <script src="https://unpkg.com/filepond-plugin-file-validate-type/dist/filepond-plugin-file-validate-type.js"></script>
  <script>
    // Initialize FilePond
  FilePond.registerPlugin(
    FilePondPluginImagePreview,
    FilePondPluginFileValidateType
  );

  const pond = FilePond.create(document.querySelector('.filepond'), {
    acceptedFileTypes: ['image/png', 'image/jpeg', 'application/pdf']
  });

  // Listen for FilePond's addfile event and update file name and type
  pond.on('addfile', (error, file) => {
    if (error) {
      console.error('File could not be added:', error);
      return;
    }

    // Update the UI with the file name and type
    document.getElementById('file-name').textContent = file.filename;
    // Extract and set the file type, removing the "application/" prefix
    document.getElementById('file-type').textContent = file.fileType ? file.fileType.split('/')[1] : '';
  });
  </script>
{% endblock %}
